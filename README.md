# nhl_schedule
Package used to re-create the season schedule for the National Hockey League

I've been to hundreds of professional hockey games, starting at the age of 4. For many years, I wondered how the league was able to make the schedule for the season which involves over 1,000 games in cities spread throughout North America, taking place in arenas which are used for other events. The schedule is very logical and minimizes travel. When I was young, I had some vague idea that a team of people worked in a room, plotting out the games by hand, perhaps moving magnetic tiles around a big board, checking and re-checking that the right number of games were played and that the schedule followed the league's rules for games played in certain amounts of time (e.g. a team can't play on three consecutive days).

Once I got older, I realized the answer to the question "how do they do that?" was "computers!" but that was as far as I got. Until now. I realized that this question which has fascinated me for decades would serve as an ideal vehicle for me to demonstrate my ability to solve complex real world problems with computer programs. The programs posted here represent my solution to this question in the Python environment with a special focus on the pandas, matplotlib, and scipy modules. 

In this set of files, I come up with a faithful re-creation of the National Hockey League 2022-2023 schedule in which 32 teams each play 82 games. The first file creates the matchups themselves, independent of any temporal constraints. The rules are as follows:

There are 2 conferences (Eastern and Western), each of which contains 2 divisions, each of which contains 8 teams. For a pair of teams in opposite conferences, one game is played at one team's home arena and one game is played at the other. For teams in different divisions in the same conference, there are 3 matchups - 2 at one arena and 1 at the other. Each team will play 4 intra-conference inter-division teams twice at home and once on the road, and the opposite for the other 4. Within one's own division, 5 teams are played 4 times, with 2 games at each location. For the remaining 2 teams, one is played twice at home and once on the road, and the other is played once at home and twice on the road. The matchups according to these constraints are generated in the nhl_make_games_list file.

In the nhl_make_schedule file, those games are turned into a full schedule. There are a variety of constraints on whether a game can be scheduled which I gleaned from careful and detailed study of the current schedule.  For example, a team can't play if they played the previous two days, three times in the last four days, four times in the last six days, or five times in the past seven days. A team can only play on back to back days if the games are within 850 miles of each other. A team can't play a home game if its arena is scheduled for another event. I simulated this constraint by randomly blocking off arenas once or twice a week. I imagine that in real life, each team is required to submit a schedule of events to the League by a certain day.

If a team travels a long distance to play a relatively isolated opponent, they need to play all the other nearby teams. For example, if a team from the East coast plays at Calgary, Edmonton, Seattle, or Vancouver, their next three games need to be against the other three teams. There are other "clusters" such as the one comprising New Jersey and the two New York teams which are all within 25 miles of each other. Invariably, Western teams play at these three teams in a sequence. A game at a "cluster team" involving long distance travel can therefore only be scheduled if the other cluster teams aren't themselves stuck at another cluster. Several other situations can "force" a team to play certain games and this needs to be accounted for when scheduling individual games. Even when clusters aren't involved, travel needs to make sense - road trips need to be in the same general direction, and teams can't go on a far trip if they've just come back from one; instead they work their way back home.

Homestands and road trips are limited as is the imbalance of home and away games for each team. The number of games played per team needs to be kept relatively balanced throughout the season - I mostly keep the difference between the maximum and minimum total at no more than 4. These limitations need to be managed proactively. For example, a team might be able to play one more road game, but not 3 in a row - therefore a game that triggers more forced road games can't be scheduled even if the game itself wouldn't result in a violation of the constraints. 

Scheduling also has to account for the All-Star break which is 4 days long. Teams have an additional 4 days off either before or after the break. All long road trips need to conclude before the all-star game, so no games that trigger "forced" games can be scheduled in the week leading up to the break. Any team playing in the 4 days before the All-Star break can't play in the 4 following days. A reduced number of games is scheduled in the days leading up to the break in order to maintain a relatively even balance of teams with their additional break before and after.

Otherwise, my schedule mimics the weekly distribution of games. The days with the most games are Tuesday, Thursday, and Saturday. There are few games on Sunday, presumably because of conflict with the more popular National Football League, but this restriction eases somewhat after the Super Bowl is played in February.

I constrain the schedule to end within a week of when the actual schedule concludes. There is some variation because of randomization, but my schedule almost always ends within 3 or 4 says of the actual ending date.

Once concluded, I export the schedule as a text file in a format like that which can be found on the League's website (https://www.nhl.com/schedule) where each day is a heading followed by that day's matchups. 

In the nhl_plots_and_stats program, I use the schedule I generated to investigate some questions about fairness and bias in travel between teams. NHL teams are predominantly located east of the Mississipi River. Eastern Teams are located relatively close to other teams in the same division and conference. Teams located far away are only played once, and all of these games are knocked out in a small number of road trips. The same cannot be said for the Western Conference - for example, Arizona (near Phoenix) and Nashville are located in the same division! 

I learned a variety of statistical techniques and had formal training in statistics while earnning a PhD in Biology. During that time, I ran complex statistical models and produced figures which were published in my first-author peer-reviewed papers. I draw on some of that experience in comparing travel between teams, divisions, and conferences statistically and graphically. While the primary purpose of this was to demonstrate my fluency with the idioms and syntax of matplotlib, the results raise some interesting questions. I also export the schedule as a CSV file in case further exploration or representation is desired. Sample output plots are included.

Taken as a whole, these programs have a little bit of everything. They demonstrate my fluency with Python's core data structures along with the universal constructs of looping, conditionals, iteration, and repetition. They also feature complex and deeply nested functions, regular expressions, list comprehensions, use of spatial data, and trig functions. I employ many of the key functional features of pandas including filtering, sorting, aggregating, manipulation, and SQL style merges and joins. There's also visualization and statistical analysis

